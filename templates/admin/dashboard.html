{% extends "base.html" %}
{% block content %}

<!-- Summary cards -->
<section class="mb-5">
	<div class="row g-4">
		<div class="col-6 col-lg-3">
			<div class="card text-center">
				<div class="card-body">
					<h5 class="fs-6 fw-bold">Total Orders</h5>
					<p class="mb-0 fs-5 text-muted">{{ total_orders }}</p>
				</div>
			</div>
		</div>

		<div class="col-6 col-lg-3">
			<div class="card text-center">
				<div class="card-body">
					<h5 class="fs-6 fw-bold">Total Revenue</h5>
					<p class="mb-0 fs-5 text-muted">{{ "{:.2f}".format(total_revenue) }} €</p>
				</div>
			</div>
		</div>

		<div class="col-6 col-lg-3">
			<div class="card text-center">
				<div class="card-body">
					<h5 class="fs-6 fw-bold">Monthly Orders</h5>
					<p class="mb-0 fs-5 text-muted">{{ total_orders_month }}</p>
				</div>
			</div>
		</div>

		<div class="col-6 col-lg-3">
			<div class="card text-center">
				<div class="card-body">
					<h5 class="fs-6 fw-bold">Monthly Revenue</h5>
					<p class="mb-0 fs-5 text-muted">{{ "{:.2f}".format(total_revenue_month) }} €</p>
				</div>
			</div>
		</div>
	</div>
</section>

<!-- Products -->
<section class="border mb-4">
	<div class="p-2 d-flex flex-wrap justify-content-between align-items-center">
		<input class="me-2 form-control form-control-sm" id="table-search" type="text" placeholder="Search products..."
			style="width: 200px;">

		<a class="btn btn-sm btn-success" href="{{ url_for('add_product') }}">
			<i class="bi bi-plus-lg"></i>
		</a>
	</div>


	<div class="table-responsive" style="height: 800px;">
		<table id="products-table" class=" mb-0 table align-middle sortable text-center">
			<!-- Header -->
			<thead class="table-dark position-sticky top-0">
				<tr>
					<th scope="col">Image</th>
					<th scope="col">Name</th>
					<th scope="col" class="d-none d-lg-table-cell">Unit price</th>
					<th scope="col" class="d-none d-lg-table-cell">Quantity</th>
					<th scope="col" class="d-none d-lg-table-cell">Stock value</th>
					<th scope="col" class="d-none d-lg-table-cell">Date d’ajout</th>
					<th scope="col">Edit</th>
					<th scope="col">Delete</th>
				</tr>
			</thead>

			<!-- Body -->
			<tbody>
				{% for product in products %}
				<tr>
					<td>
						<img class="mx-auto img-fluid rounded" src="{{ url_for('static', filename='images/product_pictures/' + product.image) }}" alt="{{ product.title }}" style="width: 50px; height: 50px; object-fit: cover;">
					</td>

					<td>
						{{ product.title }}
					</td>

					<td class="d-none d-lg-table-cell">
						{{ "{:.2f}".format(product.price) }} €
					</td>

					<td class="d-none d-lg-table-cell">
						{{ product.quantity }}
					</td>

					<td class="d-none d-lg-table-cell">
						{{ "{:.2f}".format(product.price * product.quantity) }} €
					</td>

					<td class="d-none d-lg-table-cell">
      					{{ product.date_added.strftime('%d/%m/%Y') }}
    				</td>

					<td>
						<a  class="btn btn-sm btn-primary" href="{{ url_for('edit_product', product_id=product.id) }}">
							Edit
						</a>
					</td>
					<td>
						<form action="{{ url_for('delete_product', product_id=product.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this product?');">
							<button class="btn btn-sm btn-danger" type="submit">
								Delete
							</button>
						</form>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
</section>

{% block scripts %}
<script src="{{ url_for('static', filename='js/product-table.js') }}"></script>
{% endblock %}

{% endblock %}